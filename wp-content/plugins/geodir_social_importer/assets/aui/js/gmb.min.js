var gmbAccessToken,gmbRefreshToken;jQuery(function($){$("#gmb_auth_code").val("");$("#geodir_gmb_connect").on("click",function(e){$("#gmb_auth_code").val("");setTimeout(function(){$('[data-argument="gmb_auth_code"]').removeClass("d-none")},5E3);var gmbWin=window.open(geodir_params.gmb_auth_url,"gmb_auth","scrollbars=no,menubar=no,height=600,width=750,resizable=yes,toolbar=no,status=no");return false});$("#geodir_gmb_authorize").on("click",function(){var code=$("#gmb_auth_code").val(),nonce=$(this).data("nonce"),aui_bs5=jQuery("body").hasClass("aui_bs5")?true:false;if(code&&nonce){$btn=jQuery(this);var data={"action":"geodir_gmb_authorize_user","security":nonce,"gmb_code":code};jQuery.ajax({url:geodir_params.ajax_url,type:"POST",data:data,dataType:"json",beforeSend:function(xhr,obj){$btn.prop("disabled",true);$btn.addClass("disabled");$btn.find(".geodir-spin-wrap").remove();$btn.prepend('<span class="geodir-spin-wrap '+(aui_bs5?"me-1":"mr-1")+'"><i class="fas fa-spinner fa-spin"></i>&nbsp;</span>')}}).done(function(data,textStatus,jqXHR){if(typeof data=="object"){if(data.success)if(data.data.access_token&&data.data.refresh_token){gmbAccessToken=data.data.access_token;gmbRefreshToken=data.data.refresh_token;$('[data-argument="gmb_connect"]').addClass("d-none");$('[data-argument="gmb_auth_code"]').addClass("d-none");$('[data-argument="gmb_authorized"]').removeClass("d-none");geodir_social_gmb_accounts()}if(data.data.message)alert(data.data.message)}}).always(function(data,textStatus,jqXHR){$btn.prop("disabled",false);$btn.removeClass("disabled");$btn.find(".geodir-spin-wrap").remove()})}else $("#gmb_auth_code").trigger("focus")});$("#geodir_gmb_revoke").on("click",function(){var nonce=$(this).data("nonce"),aui_bs5=jQuery("body").hasClass("aui_bs5")?true:false;if(nonce){$btn=jQuery(this);var data={"action":"geodir_gmb_revoke_user","access_token":gmbAccessToken,"security":nonce};jQuery.ajax({url:geodir_params.ajax_url,type:"POST",data:data,dataType:"json",beforeSend:function(xhr,obj){$("#gmb_auth_code").val("");$btn.prop("disabled",true);$btn.addClass("disabled");$btn.find(".geodir-spin-wrap").remove();if(aui_bs5)$btn.prepend('<span class="geodir-spin-wrap me-1"><i class="fas fa-spinner fa-spin"></i>&nbsp;</span>');else $btn.prepend('<span class="geodir-spin-wrap mr-1"><i class="fas fa-spinner fa-spin"></i>&nbsp;</span>');gmbAccessToken="";gmbRefreshToken="";$('[data-argument="gmb_account"]').addClass("d-none");$('[data-argument="gmb_location"]').addClass("d-none");if(aui_bs5){$('[data-argument="gmb_account"] .gmb-input-wrap').html('<span class="form-text d-block"><i class="fas fa-spinner fa-spin me-1" aria-hidden="true"></i> '+geodir_params.textGMBAccounts+"</span>");$('[data-argument="gmb_location"] .gmb-input-wrap').html('<span class="form-text d-block"><i class="fas fa-spinner fa-spin me-1" aria-hidden="true"></i> '+geodir_params.textGMBLocations+"</span>")}else{$('[data-argument="gmb_account"] .gmb-input-wrap').html('<span class="form-text"><i class="fas fa-spinner fa-spin mr-1" aria-hidden="true"></i> '+geodir_params.textGMBAccounts+"</span>");$('[data-argument="gmb_location"] .gmb-input-wrap').html('<span class="form-text"><i class="fas fa-spinner fa-spin mr-1" aria-hidden="true"></i> '+geodir_params.textGMBLocations+"</span>")}}}).done(function(data,textStatus,jqXHR){if(typeof data=="object"){if(data.success){$('[data-argument="gmb_connect"]').removeClass("d-none");$('[data-argument="gmb_auth_code"]').addClass("d-none");$('[data-argument="gmb_authorized"]').addClass("d-none")}if(data.data.message)alert(data.data.message)}}).always(function(data,textStatus,jqXHR){$btn.prop("disabled",false);$btn.removeClass("disabled");$btn.find(".geodir-spin-wrap").remove()})}})});function geodir_social_gmb_accounts(){jQuery("input#gmb_account").parent().addClass("gmb-input-wrap");jQuery('[data-argument="gmb_account"]').removeClass("d-none");var data={"action":"geodir_gmb_get_accounts","access_token":gmbAccessToken,"refresh_token":gmbRefreshToken,"security":jQuery("#geodir_gmb_authorize").data("account-nonce")};jQuery.ajax({url:geodir_params.ajax_url,type:"POST",data:data,dataType:"json",beforeSend:function(xhr,obj){}}).done(function(data,textStatus,jqXHR){if(typeof data=="object"){var res="",success=false;if(data.success&&data.data.input){success=true;res=data.data.input}else if(data.data.message)res=data.data.message;if(res){jQuery('[data-argument="gmb_account"] .gmb-input-wrap').html(res);if(success){if(typeof aui_init_select2==="function")aui_init_select2();jQuery("#gmb_account").on("change",function(){geodir_social_gmb_locations(this)})}}}}).always(function(data,textStatus,jqXHR){})}function geodir_social_gmb_locations(el){var account=jQuery("#gmb_account").val();var aui_bs5=jQuery("body").hasClass("aui_bs5")?true:false;if(account){jQuery("input#gmb_location").parent().addClass("gmb-input-wrap");jQuery('[data-argument="gmb_location"]').removeClass("d-none");$el=jQuery(el);var data={"action":"geodir_gmb_get_locations","access_token":gmbAccessToken,"refresh_token":gmbRefreshToken,"account":account,"security":jQuery("#geodir_gmb_authorize").data("location-nonce")};jQuery.ajax({url:geodir_params.ajax_url,type:"POST",data:data,dataType:"json",beforeSend:function(xhr,obj){$el.prop("disabled",true);$el.addClass("disabled");if(aui_bs5)jQuery('[data-argument="gmb_location"] .gmb-input-wrap').html('<span class="form-text d-block"><i class="fas fa-spinner fa-spin me-1" aria-hidden="true"></i> '+geodir_params.textGMBLocations+"</span>");else jQuery('[data-argument="gmb_location"] .gmb-input-wrap').html('<span class="form-text"><i class="fas fa-spinner fa-spin mr-1" aria-hidden="true"></i> '+geodir_params.textGMBLocations+"</span>")}}).done(function(data,textStatus,jqXHR){if(typeof data=="object"){var res="",success=false;if(data.success&&data.data.input){success=true;res=data.data.input}else if(data.data.message)res=data.data.message;if(res){jQuery('[data-argument="gmb_location"] .gmb-input-wrap').html(res);if(success&&typeof aui_init_select2==="function")aui_init_select2()}}}).always(function(data,textStatus,jqXHR){$el.prop("disabled",false);$el.removeClass("disabled")})}else{jQuery('[data-argument="gmb_location"]').addClass("d-none");jQuery("#gmb_account").trigger("focus")}};