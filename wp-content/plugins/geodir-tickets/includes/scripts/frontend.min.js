jQuery(function($){$("body").on("click",".geodir-tickets-duplicate",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");var new_ticket=modal.find(".geodir-ticket-type-wrapper").first().clone().hide();new_ticket.find(":input:not(.geodir-ticket-sell-till)").val("");new_ticket.find(".geodir-ticket-selected-by-default").val("1").prop("checked",false);new_ticket.appendTo(modal.find(".geodir-ticket-types-wrapper")).slideDown();if(modal.find(".geodir-remove-ticket").length==1){modal.find(".geodir-remove-ticket").addClass("d-none")}else{modal.find(".geodir-remove-ticket").removeClass("d-none")}});$("body").on("click",".geodir-tickets-toggle-accordion",function(e){e.preventDefault();$(this).closest(".card").find(".collapse").toggleClass("show")});$("body").on("click",".geodir-remove-ticket",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");var ticket=$(this).closest(".geodir-ticket-type-wrapper");ticket.slideUp(200,function(){$(ticket).remove();if(modal.find(".geodir-remove-ticket").length==1){modal.find(".geodir-remove-ticket").addClass("d-none")}})});$("body").on("click",".geodir-submit-sell-tickets-form",function(e){e.preventDefault();var modal=$(this).closest(".modal-content");modal.find(".geodir-sell-tickets-form").trigger("submit")});$("body").on("submit",".geodir-sell-tickets-form",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");wpinvBlock(modal);modal.find(".geodir-ticket-type-wrapper").each(function(index){$(this).find("[data-name]").each(function(){var name=$(this).data("name")+"["+index+"]";$(this).attr("name",name)})});$.post(geodir_tickets.ajax_url,modal.find(".geodir-sell-tickets-form").serialize(),function(result){if(result.success){location.reload()}})});$("body").on("click",".geodir-delete-ticket-type",function(e){e.preventDefault();if(!confirm(geodir_tickets.i18n_confirm_delete)){return false}$.post(geodir_tickets.ajax_url,$(this).data());var modal=$(this).closest(".modal-body");$(this).closest("tr").fadeOut(400,function(){if(modal.find(".geodir-manage-ticket-types-table tbody tr:visible").length===0){modal.find(".geodir-manage-ticket-types-table").addClass("d-none")}})});$("body").on("click",".geodir-add-ticket-type",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");modal.find(".geodir-add-ticket-type").toggleClass("invisible");modal.find(".geodir-add-ticket-type-form").slideToggle(200);modal.find(".geodir-ticket-name-input, .geodir-ticket-price-input, .geodir-ticket-quantity-input, .geodir-ticket-item-id-input").val("")});$("body").on("click",".geodir-add-ticket-type-form-cancel",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");modal.find(".geodir-add-ticket-type").removeClass("invisible");modal.find(".geodir-add-ticket-type-form").slideUp(200);modal.find(".geodir-ticket-name-input, .geodir-ticket-price-input, .geodir-ticket-quantity-input, .geodir-ticket-item-id-input").val("")});$("body").on("click",".geodir-edit-ticket-type",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");modal.find(".geodir-ticket-name-input").val($(this).data("ticket_name"));modal.find(".geodir-ticket-price-input").val($(this).data("ticket_price"));modal.find(".geodir-ticket-quantity-input").val($(this).data("ticket_count"));modal.find(".geodir-ticket-item-id-input").val($(this).data("item"));modal.find(".geodir-ticket-selected-by-default").prop("checked","1"==$(this).data("default"));modal.find(".geodir-ticket-sell-till").prop("checked",false).filter('[value="'+$(this).data("till")+'"]').prop("checked",true);modal.find(".geodir-add-ticket-type").addClass("invisible");modal.find(".geodir-add-ticket-type-form").slideDown(200)});$("body").on("click",".geodir-resend-ticket",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");var data=$(this).data();wpinvBlock(modal);$.post(geodir_tickets.ajax_url,data,function(result){if(result.success){alert(geodir_tickets.i18n_ticket_reset)}wpinvUnblock(modal)})});$("body").on("click",".geodir-refund-ticket",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");var $el=$(this);var data=$el.data();wpinvBlock(modal);$.post(geodir_tickets.ajax_url,data,function(result){if(result.success){alert(geodir_tickets.i18n_ticket_refunded);$el.parent().html("")}wpinvUnblock(modal)})});$("body").on("submit",".geodir-add-ticket-type-form",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");wpinvBlock(modal);$.post(geodir_tickets.ajax_url,modal.find(".geodir-add-ticket-type-form").serialize(),function(result){if(result.success){if($(result.data.replace).length>0){$(result.data.replace).replaceWith(result.data.row)}else{modal.find(".geodir-manage-ticket-types-table tbody").append(result.data.row)}modal.find(".geodir-add-ticket-type").removeClass("invisible");modal.find(".geodir-add-ticket-type-form").slideUp(200);modal.find(".geodir-ticket-name-input, .geodir-ticket-price-input, .geodir-ticket-quantity-input, .geodir-ticket-item-id-input").val("");modal.find(".geodir-ticket-selected-by-default").prop("checked",false);modal.find(".geodir-manage-ticket-types-table").removeClass("d-none");wpinvUnblock(modal)}})});$("body").on("submit",".geodir-ticket-number-scanner",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");modal.find(".geodir-ticket-number-scanner .alert, .geodir-verified-ticket-details").addClass("d-none");wpinvBlock(modal);$.post(geodir_tickets.ajax_url,modal.find(".geodir-ticket-number-scanner").serialize(),function(result){modal.find(".geodir-ticket-number-scanner .alert, .geodir-verified-ticket-details, .geodir-scanner-redeem-ticket-button-wrapper").addClass("d-none");if(result.success){modal.find(".geodir-ticket-number-scanner .alert-"+result.data.state).text(result.data.msg).removeClass("d-none");modal.find(".geodir-verified-ticket-details").removeClass("d-none");modal.find(".geodir-verified-ticket-booked").text(result.data.date_created);modal.find(".geodir-verified-ticket-number").text(result.data.number);modal.find(".geodir-verified-ticket-status").text(result.data.status);modal.find(".geodir-verified-ticket-type").text(result.data.type);modal.find(".geodir-verified-ticket-id").text(result.data.id);if("success"===result.data.state){modal.find(".geodir-scanner-redeem-ticket-button-wrapper").removeClass("d-none").find("a").data("ticket",result.data.number)}}else{modal.find(".geodir-ticket-number-scanner .alert-danger").text(geodir_tickets.i18n_invalid_ticket).removeClass("d-none")}}).fail(function(){modal.find(".geodir-ticket-number-scanner .alert, .geodir-verified-ticket-details, .geodir-scanner-redeem-ticket-button-wrapper").addClass("d-none");modal.find(".geodir-ticket-number-scanner .alert-danger").text(geodir_tickets.i18n_invalid_ticket).removeClass("d-none")}).always(function(){wpinvUnblock(modal)})});$("body").on("click",".geodir-scanner-redeem-ticket-button-wrapper a",function(e){e.preventDefault();var modal=$(this).closest(".modal-body");modal.find(".geodir-ticket-number-scanner .alert, .geodir-verified-ticket-details").addClass("d-none");wpinvBlock(modal);$.post(geodir_tickets.ajax_url,{ticket:$(this).data("ticket"),_wpnonce:$(this).data("nonce"),action:"geodir_redeem_ticket",listing:$(this).data("listing")},function(result){modal.find(".geodir-ticket-number-scanner .alert-success").text(geodir_tickets.i18n_success).removeClass("d-none")}).fail(function(){modal.find(".geodir-ticket-number-scanner .alert-danger").text(geodir_tickets.i18n_error).removeClass("d-none")}).always(function(){wpinvUnblock(modal)})});$(".geodir-ticket-number-scanner .form-control").on("input",function(){var modal=$(this).closest(".modal-body");modal.find(".geodir-ticket-number-scanner .alert, .geodir-verified-ticket-details").addClass("d-none")});$(".geodir-manage-ticket-sales-table-filter").on("keyup",function(){var modal=$(this).closest(".modal-body");var value=$(this).val().toLowerCase();modal.find(".geodir-manage-ticket-sales-table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(value)>-1)})});$(".geodir-tickets-pie-chart").each(function(){var data=$(this).data("points");var ctx=$(this);new Chart(ctx,{type:"pie",data:data})});if($(".geodir-ticket-scanner-app").length>0){$(".geodir-ticket-scanner-app").each(function(){var app_id=$(this).attr("id");var tab_id=$("#geodir-manage-tickets-tab-scanner-"+app_id.replace("geodir-ticket-scanner-app-",""));var rendered=false;var form=$(this).closest("form");tab_id.on("click",function(){if(!rendered){var app=new Html5QrcodeScanner(app_id,{fps:10,qrbox:250});function onScanSuccess(decodedText,decodedResult){form.find(".form-control").val(decodedText).trigger("input");form.trigger("submit");$("#"+app_id+"__dashboard_section_csr button:visible").trigger("click")}function onScanFailure(error){}app.render(onScanSuccess,onScanFailure);rendered=true}})})}});